<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Bicycle travels in France</title>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCKl0pvlPQb6NH85qmSvqOxpUnWGLkmwJE&callback=initMap&libraries=drawing&v=weekly"
      defer
    ></script>
    <style type="text/css">
      #map {
        height: 100vh;
        width: 100%;
      }
    </style>
    <script>
        function initMap() {
            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 3,
                center: { lat: 0, lng: -180 },
                mapTypeId: "terrain",
                disableDefaultUI: true,
            });

            fetch('tmp.gpx')
                .then(response => response.text())
                .then(str => (new window.DOMParser()).parseFromString(str, "text/xml"))
                //.then(data => console.log(data))
                .then(doc =>
                {
                    var bounds = new google.maps.LatLngBounds();

                    const trks = [...doc.getElementsByTagName('trk')];
                    trks.forEach(trk =>
                    {
                        console.log("trk");
                        var points = [];
                        const nodes = [...trk.getElementsByTagName('trkpt')];
                        nodes.forEach(node =>
                        {
                            var lat = node.getAttribute("lat");
                            var lon = node.getAttribute("lon");
                            console.log(lat);

                            var p = new google.maps.LatLng(lat, lon);
                            points.push(p);
                            bounds.extend(p);
                        })

                        var poly = new google.maps.Polyline({
                                 path: points,
                                 strokeColor: "#0000FF",
                                 strokeOpacity: 1,
                                 strokeWeight: 4
                            });
                        poly.setMap(map);
                    })
                    // fit bounds to track
                    map.fitBounds(bounds);
                })
        }
    </script>
  </head>
  <body>
    <div id="map"></div>
  </body>
</html>
